import{R as d}from"./chunk-B7RQU5TL-DOIyb4rl.js";const k=s=>{let r;const n=new Set,i=(c,f)=>{const o=typeof c=="function"?c(r):c;if(!Object.is(o,r)){const p=r;r=f??(typeof o!="object"||o===null)?o:Object.assign({},r,o),n.forEach(y=>y(r,p))}},l=()=>r,h={setState:i,getState:l,getInitialState:()=>g,subscribe:c=>(n.add(c),()=>n.delete(c))},g=r=s(i,l,h);return h},x=(s=>s?k(s):k),E=s=>s;function R(s,r=E){const n=d.useSyncExternalStore(s.subscribe,d.useCallback(()=>r(s.getState()),[s,r]),d.useCallback(()=>r(s.getInitialState()),[s,r]));return d.useDebugValue(n),n}const j=s=>{const r=x(s),n=i=>R(r,i);return Object.assign(n,r),n},K=(s=>s?j(s):j),u=()=>typeof window<"u"&&window.puter?window.puter:null,V=K((s,r)=>{const n=t=>{s({error:t,isLoading:!1,auth:{user:null,isAuthenticated:!1,signIn:r().auth.signIn,signOut:r().auth.signOut,refreshUser:r().auth.refreshUser,checkAuthStatus:r().auth.checkAuthStatus,getUser:r().auth.getUser}})},i=async()=>{const t=u();if(!t)return n("Puter.js not available"),!1;s({isLoading:!0,error:null});try{if(await t.auth.isSignedIn()){const a=await t.auth.getUser();return s({auth:{user:a,isAuthenticated:!0,signIn:r().auth.signIn,signOut:r().auth.signOut,refreshUser:r().auth.refreshUser,checkAuthStatus:r().auth.checkAuthStatus,getUser:()=>a},isLoading:!1}),!0}else return s({auth:{user:null,isAuthenticated:!1,signIn:r().auth.signIn,signOut:r().auth.signOut,refreshUser:r().auth.refreshUser,checkAuthStatus:r().auth.checkAuthStatus,getUser:()=>null},isLoading:!1}),!1}catch(e){const a=e instanceof Error?e.message:"Failed to check auth status";return n(a),!1}},l=async()=>{const t=u();if(!t){n("Puter.js not available");return}s({isLoading:!0,error:null});try{await t.auth.signIn(),await i()}catch(e){const a=e instanceof Error?e.message:"Sign in failed";n(a)}},S=async()=>{const t=u();if(!t){n("Puter.js not available");return}s({isLoading:!0,error:null});try{await t.auth.signOut(),s({auth:{user:null,isAuthenticated:!1,signIn:r().auth.signIn,signOut:r().auth.signOut,refreshUser:r().auth.refreshUser,checkAuthStatus:r().auth.checkAuthStatus,getUser:()=>null},isLoading:!1})}catch(e){const a=e instanceof Error?e.message:"Sign out failed";n(a)}},v=async()=>{const t=u();if(!t){n("Puter.js not available");return}s({isLoading:!0,error:null});try{const e=await t.auth.getUser();s({auth:{user:e,isAuthenticated:!0,signIn:r().auth.signIn,signOut:r().auth.signOut,refreshUser:r().auth.refreshUser,checkAuthStatus:r().auth.checkAuthStatus,getUser:()=>e},isLoading:!1})}catch(e){const a=e instanceof Error?e.message:"Failed to refresh user";n(a)}},h=()=>{if(typeof window>"u"){s({puterReady:!1,isLoading:!1});return}if(u()){s({puterReady:!0}),i();return}const e=setInterval(()=>{u()&&(clearInterval(e),s({puterReady:!0}),i())},100);setTimeout(()=>{clearInterval(e),u()||s({puterReady:!1,isLoading:!1,error:null})},1e4)},g=async(t,e)=>{const a=u();if(!a){n("Puter.js not available");return}return a.fs.write(t,e)},c=async t=>{const e=u();if(!e){n("Puter.js not available");return}return e.fs.readdir(t)},f=async t=>{const e=u();if(!e){n("Puter.js not available");return}return e.fs.read(t)},o=async t=>{const e=u();if(!e){n("Puter.js not available");return}return e.fs.upload(t)},p=async t=>{const e=u();if(!e){n("Puter.js not available");return}return e.fs.delete(t)},y=async(t,e,a,b)=>{const I=u();if(!I){n("Puter.js not available");return}return I.ai.chat(t,e,a,b)},U=async(t,e)=>{const a=u();if(!a){n("Puter.js not available");return}return a.ai.chat([{role:"user",content:[{type:"file",puter_path:t},{type:"text",text:e}]}],{model:"gpt-5-nano"})},P=async(t,e)=>{const a=u();if(!a){n("Puter.js not available");return}return a.ai.img2txt(t,e)},w=async t=>{const e=u();if(!e){n("Puter.js not available");return}return e.kv.get(t)},m=async(t,e)=>{const a=u();if(!a){n("Puter.js not available");return}return a.kv.set(t,e)},A=async t=>{const e=u();if(!e){n("Puter.js not available");return}return e.kv.delete(t)},O=async(t,e)=>{const a=u();if(!a){n("Puter.js not available");return}return e===void 0&&(e=!1),a.kv.list(t,e)},L=async()=>{const t=u();if(!t){n("Puter.js not available");return}return t.kv.flush()};return{isLoading:!0,error:null,puterReady:!1,auth:{user:null,isAuthenticated:!1,signIn:l,signOut:S,refreshUser:v,checkAuthStatus:i,getUser:()=>r().auth.user},fs:{write:(t,e)=>g(t,e),read:t=>f(t),readDir:t=>c(t),upload:t=>o(t),delete:t=>p(t)},ai:{chat:(t,e,a,b)=>y(t,e,a,b),feedback:(t,e)=>U(t,e),img2txt:(t,e)=>P(t,e)},kv:{get:t=>w(t),set:(t,e)=>m(t,e),delete:t=>A(t),list:(t,e)=>O(t,e),flush:()=>L()},init:h,clearError:()=>s({error:null})}});export{V as u};
